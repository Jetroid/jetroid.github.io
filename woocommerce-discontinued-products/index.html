<!DOCTYPE html>

<html lang="en" Itemscope=”Blog”>
	<head>
	<link rel="dns-prefetch" href="//www.google-analytics.com" />
	<link rel="preconnect" href="https://www.google-analytics.com" crossorigin>

	<!-- Custom Preconnects - use custom_preconnect in YAML front matter !-->
	
    
    
	

	<title itemprop=”name”>Woocommerce Discontinued Products - Jet Holt</title>
<meta name="description" content="...and other custom stock statuses." />
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="shortcut icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHiAiACAhocHbnaJSFNehKdARFTkCgcI+wYDBfsFAwbkFRQepycnOUgBAAAHDQoSAAAAAAAAAAAAenx1AICKlgCAiZQYf4eQkneAj+5SXof/SlBk/w8MDv8GBAb/BQMF/woHCv8OCg/uExEakjY6ShgmJjEAMkR9AIaVqgCGl6wYhJChsX2Il/9kb4L/PUVi/zA0Qv8NCQz/CAUH/wcEBv8GAwX/CQQH/xcWH/9KUGOxZm+DGFtjeACMmasGiZirkoqZrf9/jaH/T1dl/xENEP8IBQf/CQUH/woGCP8JBgf/BwQF/wcEBv8ZFx//XWBv/2hte5JlbH0GoaawSZ+lsO2jqLL/qK65/4aJkv8SDxD/CAUG/woGCP8LBgf/CgUH/wkFB/8MBwn/Hh0k/36BjP+AhpPtdHqJSbe2uKe3trj/uLa4/7q4uv+RjZD/Ew4Q/woFB/8OCg//Hh0t/xQQGP8NCAn/DgkK/y4rMP+mqK3/ub3C/6mutqfGxsbjxsXF/8TExP/ExMX/rKys/ywnJ/8LBQX/Gxwr/zM/a/8tNlb/DwsP/xEMDv9qamz/wsPD/6yusP9dX2Tjy8fG+8rHxv/Jxsf/yMfJ/8jIyv+cmp3/QTw+/yImOP82TID/SWqk/zQ4SP9tZ2b/wLq4/9PLyf+5s7P/cGpq+8C9wPvFv7//zMTD/9DIxv/Uzcv/1tDP/5+fqv9BS3H/TG+q/1d9tf95eYL/1MjD/93SzP/azsj/18zH/8/Gwvu/u7Ljw7yw/8bAtP/Kw7j/xL+2/7+8tP+EhJb/RVCI/2CAv/9IaaL/V1hj/8a+tP/Nxbv/zMS7/87Hwf/MxsHjx7ulp8O3of/BtZ//xbqk/7+0nf+1q5T/aWdy/0dPff9PX43/NERo/3Z3eP++tZz/wrqi/8a/qv/IxLP/y8i8p8m5oUnJuqLtxraf/8GxmP+/rZP/u6qP/2BbXf85Plr/OkZm/zE/WP+LjIz/yLmi/8a4of/Jv6r/ycGv7czHt0nCspkGyLmlkse5pv++r5r/v7CZ/8W1nf99dnD/LjE9/zU+Uf9WYHL/rqWa/8a2ov/EtaD/xLak/8G0opLMxbkG3trTANrUyxjj49yx5ubh/+bn4//m5+P/3+De/7e7vf+0u8D/0dXX/+Tm4v/j5eH/4uXg/9zd2LHEvLAYysW8APr+/gDu8u0A7vPuGPD08JLy9fDu8vXv//P28P/1+PL/9fjy//T38P/z9u7/8vbv7vH38ZLy+vgY8Pj1AP///wAAAAAAAAAAAPPz5wDz8+YH9fXqSPf476f3+O/k+Pft+/j36/v49+vk9/frp/b360j19uoH9fbrAAAAAAAAAAAA4AcAAMADAACAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIABAADAAwAA4AcAAA==" />

<meta name="author" content="Jet Holt" />
<meta property="og:title" content="Woocommerce Discontinued Products" />
<meta property="og:locale" content="en_GB" />
<meta property="og:description" content="...and other custom stock statuses." />
<meta property="og:url" content="https://jetholt.com/woocommerce-discontinued-products/" />
<meta property="og:site_name" content="Jet Holt" />
<meta property="og:type" content="website" />
<meta property="og:image" content="https://jetholt.com/assets/images/backgrounds/" />
<meta name="twitter:card" content="summary_large_image" />
<meta name=”twitter:url” content=”https://jetholt.com/woocommerce-discontinued-products/”>
<meta name="twitter:title" content="Woocommerce Discontinued Products - Jetroid" />
<meta name="twitter:description" content="...and other custom stock statuses." />
<meta name="twitter:creator" content="@jetroidmakes" />
<meta name="twitter:site" content="@jetroidmakes" />


<meta property="og:image" content="https://jetholt.com/assets/images/backgrounds/background-blog.jpg" />
<meta name="twitter:image" content="https://jetholt.com/assets/images/backgrounds/background-blog.jpg" />

<script type="application/ld+json">
{"sameAs":["https://twitter.com/JetroidMakes","https://www.instagram.com/jetroidmakes/","https://www.facebook.com/Jetroid"],"@type":"WebSite","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://jetholt.com/assets/images/jetroid-logo-miami.png"},"name":"Jetroid"},"url":"https://jetholt.com/","name":"Jetroid","author":{"@type":"Person","name":"Jet Holt"},"image":"https://jetholt.com/assets/images/jetroid-logo-miami.png","headline":"Jetroid","description":"Jet 'Jetroid' Holt. Maker, programmer, and Computer Science graduate.","@context":"http://schema.org"}</script>
<link rel="alternate" type="application/rss+xml" title="Jet Holt &raquo; Main Posts RSS Feed" href="/feed.xml" />
<link rel="alternate" type="application/rss+xml" title="Jet Holt &raquo; Micro RSS Feed" href="/microfeed.xml" />
<link rel="alternate" type="application/rss+xml" title="Jet Holt &raquo; Everything RSS Feed" href="/all.xml" />


	<meta name="google-site-verification" content="9pNs8vHQ1C9hsyUgQ6tFQDPzNH_ANAd8kB9GcnBARYc" />

	

	<script>
		window.lazyLoadOptions = {
			threshold: 250
		};
		window.addEventListener(
			"LazyLoad::Initialized",
			function (event) {
				window.lazyLoadInstance = event.detail.instance;
			},
			false
		);
	</script>
	<!-- Custom CSS
			Seperate file - use css in YAML front matter
			Inline - use inline_css in YAML front matter !-->


<style>
*{margin:0;padding:0;box-sizing:border-box}.nobr{white-space:nowrap}.hidden{display:none !important}.hidden-opacity{opacity:0;pointer-events:none}.sr-only{position:absolute;white-space:nowrap;width:1px;height:1px;overflow:hidden;border:0;padding:0;clip:rect(0 0 0 0);clip-path:inset(50%);margin:-1px}img:not([src]):not([srcset]){visibility:hidden}:root{--white: #cfcfc9;--grey: #373731;--gray: #373731;--pink: #d05d5d;--lightblue: #94cbc4}body{font-family:monospace;color:#cfcfc9}.main-wrapper{overflow-x:hidden;width:100vw}a,.clickable{text-decoration:none;color:#d05d5d}a:hover,.clickable:hover{text-shadow:0.08em -0.08em #373731;cursor:pointer;text-decoration:underline}.handwritten{font-family:Caveat Brush, cursive !important}body{font-family:monospace}code.highlighter-rouge{background:#373731;white-space:pre-wrap}#page-header{width:100%;text-align:center;position:relative;height:20vh}.post #page-header{height:100vh}#title-stuff{position:absolute;width:100%;top:50%;left:50%;transform:translate(-50%, -50%)}.micro #page-header{height:auto}.micro #title-stuff{padding-top:5vh;position:static;transform:none}th,td,table{box-sizing:border-box;border:1px solid #373731;border-collapse:collapse}table{width:100%}.table-container{width:100%;overflow-x:auto;margin-bottom:1em}th,td{padding-left:10px;padding-right:10px}td{text-align:right}#page-title{color:#d05d5d;font-family:"Roboto",Helvetica,sans-serif;font-weight:100;margin-bottom:5px;font-weight:bold;text-shadow:2px 2px #373731;font-size:10vw}#page-subtitle{margin:0;font-weight:bold;text-shadow:0px 1px #373731, 0px -1px #373731, 1px 0px #373731, -1px 0px #373731, 2px 2px #373731}.divider{width:100%;height:0.3vh;background:#cfcfc9;display:block;box-sizing:border-box}#post-content>h1:first-child,#post-content>h2:first-child{padding-top:20px}#post-content,#calltoaction,#page-subtitle{font-size:5vw}#post-content h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:0}#post-content h1{font-size:7.5vw}#post-content h2{font-size:7.25vw}#post-content h3{font-size:7vw}#post-content h4{font-size:6.75vw}#post-content h5{font-size:6.5vw}#post-content h6{font-size:6.25vw}.post-date{margin-top:0;margin-bottom:0;font-size:5vw}.post-container,#navigation{padding-top:20px;padding-bottom:20px}.post-container img{display:block;max-width:100%;max-height:600px;margin:0 auto;border-radius:5px}.post-container a>img.lazy{height:1px}a.img+a.img,img+img,em+a.img,em+img{margin-top:10px !important;display:block}.post-container img.loaded{height:auto !important}img.emoji{display:inline;height:1em;width:1em}#post-content>p:first-child{margin-top:1vh}a.img+em,img+em{display:block;text-align:center}blockquote{background:rgba(55,55,49,0.3);border:2px solid #d05d5d;border-style:none none none solid;margin:1em 0}@media (min-width: 500px){blockquote{margin:1em 1em}}blockquote p{margin:0 0 0 1em}pre,code{border:1px solid #d05d5d}pre{white-space:pre;overflow:auto;background-color:#474741;padding:15px}pre code{border:none;font-size:smaller}p code{word-break:break-all}#post-content small{font-size:smaller}#post-content small *{font-size:1em}@media (min-width: 500px){#post-content>p{text-align:justify}}#navigation{margin:0;font-size:4vw;display:block;width:auto;overflow:hidden}#navigation .divider{margin-bottom:20px}#navigation a,#navigation p{margin:0;display:block;width:100%;margin:5px 0}#navigation #next-post{text-align:right}@media (min-width: 500px){#navigation a,#navigation p{width:50%;float:left;margin:0}}.youtube{position:relative;padding-bottom:56.25%;padding-top:25px;height:0;margin-bottom:25px}.youtube iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:none}#post-content>p:last-child>a:not(.img):not(.no-cta):only-child::before,#post-content a.cta::before{content:"► "}#post-content>p:last-child>a:not(.img):not(.no-cta):only-child,#post-content a.cta{font-size:larger}.spoiler:hover{color:#cfcfc9;background:transparent}.spoiler{color:#d05d5d;background:#d05d5d}.spoiler::before{content:"Spoiler";position:relative;color:#cfcfc9;margin:auto}.spoiler:hover::before{display:none}.visually-hidden{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap}@media (min-width: 500px){#page-title{font-size:5vw}#post-content,#calltoaction,#page-subtitle{font-size:1.4vw}#post-content h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:0}#post-content h1{font-size:3.5vw}#post-content h2{font-size:3.25vw}#post-content h3{font-size:3vw}#post-content h4{font-size:2.75vw}#post-content h5{font-size:2.5vw}#post-content h6{font-size:2.25vw}.post-date{font-size:1.5vw}#navigation{font-size:2.2vw}}@media (min-width: 1440px){#page-title{font-size:72px}#post-content,#calltoaction,#page-subtitle{font-size:20px}#post-content h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:0}#post-content h1{font-size:3.5vw}#post-content h2{font-size:3.25vw}#post-content h3{font-size:3vw}#post-content h4{font-size:2.75vw}#post-content h5{font-size:2.5vw}#post-content h6{font-size:2.25vw}.post-date{font-size:1.5vw}#navigation{font-size:2.2vw}}.borders{padding-left:9vw;padding-right:9vw}@media (min-width: 500px){.borders{padding-left:6vw;padding-right:6vw}}@media (min-width: 800px){.borders{padding-left:12vw;padding-right:12vw}}@media (min-width: 1000px){.borders{padding-left:18vw;padding-right:18vw}}body{background-position:center center;background-size:cover;background-repeat:no-repeat;background-attachment:fixed}.background{background:rgba(55,55,49,0.9)}@media (min-width: 500px){#mailchimp-text{font-size:2.5vh}.mailchimp-entry{width:30%}#mailchimp-submit{width:29%}}@media (max-width: 500px){#mailchimp-signup form input{width:100%;margin:0 auto;padding:15px 15px}}#mailchimp-submit{background:#d05d5d;color:black;-webkit-box-shadow:inset 0 5px rgba(255,255,255,0.2);-moz-box-shadow:inset 0 5px rgba(255,255,255,0.2);box-shadow:inset 0 5px rgba(255,255,255,0.2)}#mailchimp-signup form input{font-size:3vh;padding:10px 15px;border:none;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#mailchimp-signup{text-align:center}#mailchimp-signup form{margin:0 auto;width:100%;padding-top:20px}#linkback,#linkback img{width:300px;z-index:50000;position:relative}@media (max-width: 500px){#linkback img{width:50%}}#linkback a img{position:absolute;left:0}

</style><!-- Custom Stylesheets - use custom_css in YAML front matter !-->



<!-- Google Fonts
			Linking as a stylesheet directly from their API.
			- use google_font in YAML front matter.
			- Just include the name (as it would appear in a URL)
			for example "Nanum+Pen+Script"
		!--><!-- Custom Google Fonts - use google_font in YAML front matter !-->





<!-- Set Canonical URLS for latest and latestmicro !-->
	
		<link rel="canonical" href="https://jetholt.com/woocommerce-discontinued-products/" />
	

	</head>
	<body class="lazy" data-bg="background-blog.jpg">
		<div class="main-wrapper">
		
		<nav id="linkback"><a href="/"><img src="/assets/images/jetroid-logo-miami.png"></a></nav>
		

		<div id="inside" class="post">

<header id="page-header">
	<nav id="linkback"><a href="/"><img src="/assets/images/jetroid-logo-miami.png"></a></nav>
	<div id="title-stuff">
		<h1 id="page-title" class="borders">Woocommerce Discontinued Products</h1>
		<p id="page-subtitle" class="borders">...and other custom stock statuses.</p>
	</div>
</header>
<div class="background  borders">
	<article class="post-container">
		<time class="post-date">2019/12/12</time>
		<hr class="divider">
		<div id="post-content">
<p><strong>Whilst developing the new <a href="https://frequencycentral.co.uk/">Frequency Central website</a>, I found that we wanted to include a ‘product lifecycle’ to our WooCommerce products, distinct from the default stock handling that WooCommerce provides natively, as we wanted to distinguish out of stock products from discontinued products, and not yet released products from products that were on backorder. This is a quick guide that you can use to do that, intended for programmers or confident WooCommerce administrators.</strong></p>

<p>Frequency Central produces hardware products aimed at consumers. We often have technical documents that we want to keep online when we discontinue a product. I needed a way to keep pages online but prevent customers from purchasing them. This is what I came up with.</p>

<p><img src="https://jetholt.com/assets/images/content/lifecycle-fc.png" alt="Customers cannot buy this product, and are notified of a replacement product. Technical documents are still available.">
<em>Customers cannot buy this product, and are notified of a replacement product. Technical documents are still available.</em></p>

<p>I’ll be walking you through step by step on what to do to achieve something similar. This guide intended for people comfortable with editing a themes’ <code class="language-plaintext highlighter-rouge">functions.php</code> file.</p>

<p>Just want the code? <a href="#bringing-it-all-together-tldr">Skip to the TLDR</a>.</p>

<h1 class="no_toc" id="table-of-contents">Table of Contents</h1>

<ul id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#create-the-fields" id="markdown-toc-create-the-fields">Create the fields</a></li>
  <li><a href="#functionsphp" id="markdown-toc-functionsphp">Functions.php</a></li>
  <li><a href="#helper-functions" id="markdown-toc-helper-functions">Helper Functions</a></li>
  <li><a href="#preventing-purchase" id="markdown-toc-preventing-purchase">Preventing Purchase</a></li>
  <li><a href="#notifying-customers" id="markdown-toc-notifying-customers">Notifying Customers</a></li>
  <li><a href="#bringing-it-all-together-tldr" id="markdown-toc-bringing-it-all-together-tldr">Bringing it all together (TL:DR)</a></li>
</ul>

<h1 id="introduction">Introduction</h1>

<p>WooCommerce developers <a href="https://github.com/woocommerce/woocommerce/pull/10080">seem reluctant to support features in this category,</a>. but there are many reasons why you’d want to have a custom stock status / product lifecycle for your products.</p>

<ul>
  <li>You don’t want to delete the page for discontinued products, because you may have important technical documents that you want to keep available, and you don’t want to damage your SEO or confuse your customers.</li>
  <li>You don’t want to list a discontinued product as ‘Out of Stock’ as it gives a false impression that it may be available again one day. Instead you’d prefer to recommend an alternative replacement product line that may lead to a conversion.</li>
  <li>You want to be able to display forthcoming products to build a ‘buzz’ before they are released.</li>
</ul>

<p>For this tutorial, I will be creating the following statuses:</p>

<ul>
  <li>
    <p><strong>Discontinued</strong>, for products that we’re not selling anymore and don’t intend to. We’ll include an (optional) ‘Replaced By’ field where we can list ‘successor’ products that the customer might be interested in instead.</p>
  </li>
  <li>
    <p><strong>For Sale</strong>, for all products that we are actively selling.</p>
  </li>
  <li>
    <p><strong>Forthcoming</strong>, for products that aren’t for sale yet but will be available soon. We’ll also include an (optional) date field we can use to automatically convert the product to ‘For Sale’ on a specific date/time.</p>
  </li>
</ul>

<h1 id="create-the-fields">Create the fields</h1>

<p>I’m using <a href="https://www.advancedcustomfields.com/">Advanced Custom Fields</a> for this tutorial, as it’s a superb plugin that does a lot of the heavy lifting for us. Not sponsored, it’s just my favourite wordpress plugin!</p>

<p>I’ve exported my configuration <a href="/assets/product-lifestyle-acf.json">here</a> for you to use. You can import this directly with Advanced Custom Fields. From the Wordpress Admin area, go to Custom Fields &gt; Tools &gt; Import Field Groups and select the file.</p>

<p>You should then be able to edit any product and see a menu like this:</p>

<p><img src="https://jetholt.com/assets/images/content/lifecycle-acf-menu.png" alt="Advanced Custom Fields Menu where Produce Lifecycle is selectable"></p>

<hr>

<p>In case the import functionality stops working at some point in the future, here is a brief summary of the fields needed:</p>

<ul>
  <li><small>A radio button field with the name ‘product_status’, that returns the Value. Has the following values:</small></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>forsale : For Sale
discontinued : Discontinued
forthcoming : Forthcoming
</code></pre></div></div>

<ul>
  <li>
    <p><small>A ‘Post Object’ field with the name ‘replaced_with’, (filtered by ‘Product’ post type), that allows you to select multiple values, and returns the Post ID. This field has the conditional logic that it should only show when ‘product_status’ has the value of ‘Discontinued’.</small></p>
  </li>
  <li>
    <p><small>A ‘Date Time Picker’ field with the name ‘available_from’, with the custom return format <code class="language-plaintext highlighter-rouge">F j, Y</code>. The field has the conditional logic that it should only show when ‘product_status’ has the value of ‘Forthcoming’.</small></p>
  </li>
</ul>

<hr>

<h1 id="functionsphp">Functions.php</h1>

<p>For the rest of the tutorial, we will be editing your theme’s <code class="language-plaintext highlighter-rouge">functions.php</code> file. If you’re using a theme designed by someone else, <a href="https://docs.woocommerce.com/document/set-up-and-use-a-child-theme/">ensure you’re working with a child theme first</a>. Always backup your <code class="language-plaintext highlighter-rouge">functions.php</code> file before changing anything, and only edit it if you feel confident that you know what you are doing, as it is a very important file that can break your whole website if mistreated.</p>

<h1 id="helper-functions">Helper Functions</h1>

<p>First, we’ll create three helper functions that we can use to make sense of the data returned from Advanced Custom Fields. These functions will allow us to check if a product is released (<code class="language-plaintext highlighter-rouge">For Sale</code> and <code class="language-plaintext highlighter-rouge">Forthcoming [after release date]</code>), <code class="language-plaintext highlighter-rouge">Discontinued</code>, or <code class="language-plaintext highlighter-rouge">Forthcoming [before release date]</code>. These functions are fairly simple and should be easy to understand.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">is_released</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$status</span> <span class="o">=</span> <span class="nf">get_field</span><span class="p">(</span><span class="s1">'product_status'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>

	<span class="c1">// We consider null to mean for sale too,</span>
	<span class="c1">// as products where we haven't made a selection yet will have a null status</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$status</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$status</span> <span class="o">===</span> <span class="s2">"forsale"</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">True</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$status</span> <span class="o">===</span> <span class="s2">"forthcoming"</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* A product can also be released if it was forthcoming
		with an 'available from' date that has already happened */</span>
		<span class="nv">$release_date</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nf">get_field</span><span class="p">(</span><span class="s1">'available_from'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">));</span>

		<span class="c1">// For a 'forthcoming' to actually be released,</span>
		<span class="c1">// it must have a release date, and that release date has already happened.</span>
		<span class="k">return</span> <span class="nv">$release_date</span> <span class="o">&amp;&amp;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nv">$release_date</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">False</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">is_forthcoming</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$status</span> <span class="o">=</span> <span class="nf">get_field</span><span class="p">(</span><span class="s1">'product_status'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$status</span> <span class="o">===</span> <span class="s2">"forthcoming"</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$release_date</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nf">get_field</span><span class="p">(</span><span class="s1">'available_from'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">));</span>

		<span class="c1">// To be forthcoming, either no release date was set, or the date has not happened yet.</span>
		<span class="k">return</span> <span class="o">!</span><span class="nv">$release_date</span> <span class="o">||</span> <span class="nb">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nv">$release_date</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">False</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">is_discontinued</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$status</span> <span class="o">=</span> <span class="nf">get_field</span><span class="p">(</span><span class="s1">'product_status'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
	<span class="k">return</span> <span class="nv">$status</span> <span class="o">===</span> <span class="s2">"discontinued"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="preventing-purchase">Preventing Purchase</h1>

<p>Next, we want to prevent customers from purchasing products that aren’t available. We’ll be hiding the actual buy buttons later, but it’s important to do this too because it will remove the discontinued products from the cart, and prevent purchase by going to specific links (rather than through our interface).</p>

<p>WooCommerce provides two filters, <a href="http://hookr.io/filters/woocommerce_is_purchasable/">woocommerce_is_purchasable</a> and <a href="http://hookr.io/filters/woocommerce_variation_is_purchasable/">woocommerce_variation_is_purchasable</a>, that thankfully does everything we need here. If we return <code class="language-plaintext highlighter-rouge">False</code> in these functions, the product cannot be purchased and is automatically removed from customer carts where appropriate.</p>

<p>Thanks to our helper functions, calling these filters is incredibly straightforward:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Prevent purchase of products that are not considered released */</span>
<span class="nf">add_filter</span><span class="p">(</span><span class="s1">'woocommerce_is_purchasable'</span><span class="p">,</span> <span class="s1">'lifecycle_woocommerce_is_purchasable'</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">function</span> <span class="n">lifecycle_woocommerce_is_purchasable</span><span class="p">(</span><span class="nv">$is_purchasable</span><span class="p">,</span> <span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nv">$is_purchasable</span> <span class="o">&amp;&amp;</span> <span class="nf">is_released</span><span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="nf">get_id</span><span class="p">());</span>
<span class="p">}</span>

<span class="nf">add_filter</span><span class="p">(</span><span class="s1">'woocommerce_variation_is_purchasable'</span><span class="p">,</span> <span class="s1">'lifecycle_woocommerce_variation_is_purchasable'</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">function</span> <span class="n">lifecycle_woocommerce_variation_is_purchasable</span><span class="p">(</span><span class="nv">$is_purchasable</span><span class="p">,</span> <span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1"># ACF information for variation products is in the base (parent) product.</span>
	<span class="k">return</span> <span class="nv">$is_purchasable</span> <span class="o">&amp;&amp;</span> <span class="nf">is_released</span><span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="nf">get_parent_id</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Once done, trying to add the discontinued products to the cart has this effect:</p>

<p><img src="https://jetholt.com/assets/images/content/lifecycle-unavailable.png" alt="Discontinued and forthcoming products can no longer be purchased.">
<em>Discontinued and forthcoming products can no longer be purchased.</em></p>

<p>This change also has the effect of changing the appearance of the buttons on the archive page of the site. (Shown here is the ‘Twenty Twenty’ theme, which just has a ‘Select Options’ button for variable products. It’s likely that will have to edit the archive template for your theme, but I won’t - and can’t - cover that. I’d look into overriding the <a href="http://hookr.io/actions/woocommerce_after_shop_loop_item/">woocommerce_after_shop_loop_item</a> action in the same way I override <code class="language-plaintext highlighter-rouge">woocommerce_single_product_summary</code> in the next section.)</p>

<p><img src="https://jetholt.com/assets/images/content/lifecycle-readmore.png" alt="The product archive list also changes.">
<em>The product archive list also changes.</em></p>

<h1 id="notifying-customers">Notifying Customers</h1>

<p>Finally, we want to let the customer know that a given product is forthcoming or has been discontinued, and tell them when forthcoming products will be available, and which products replace discontinued products.</p>

<p>We’ll display this as a simple span on the ‘single product’ page, like this:</p>

<p><img src="https://jetholt.com/assets/images/content/lifecycle-discontinued.png" alt="Discontinued product notification.">
<em>Discontinued product notification.</em></p>

<p><img src="https://jetholt.com/assets/images/content/lifecycle-forthcoming.png" alt="Forthcoming product notification.">
<em>Forthcoming product notification.</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/* Remove the add to cart buttons... We add it back later when needed */
remove_action( 'woocommerce_single_product_summary', 'woocommerce_template_single_add_to_cart', 30 );

/* Replace the add to cart buttons with our custom text */
add_filter( 'woocommerce_single_product_summary', 'lifecycle_single_add_to_cart', 30 );
/* Helper functions to generate the discontinued replacement products list: */
function id_to_link($product_id){
    $product = wc_get_product( $product_id );
    return '&lt;a href="'. get_permalink( $product_id ) .'"&gt;' . $product-&gt;get_title() . '&lt;/a&gt;';
}
function lifecycle_single_add_to_cart() {
	global $product;
	$id = $product-&gt;get_id();
	$status = get_field('product_status', $id);

	if ( is_released($id) ) {
		/* Product is released, so use the default add to cart buttons */
		woocommerce_template_single_add_to_cart();
	} else if ( is_discontinued($id) ) {

		// Replaced with is an array containing the ids of replacement products
		$replaced_with = get_field('replaced_with', $id);
	    if($replaced_with) {

	        // Turn the array of id's of replacement products into an array of links
	        $titles_as_links = array_map(function ($product_id) {return id_to_link($product_id);}, $replaced_with);

	        // We want to join the array to follow the rules of sentences, like this:
	        // item 1, item 2, and item 3
	        // ... rather than just item 1, item 2, item 3, like regular implode would.
	        if ( count($titles_as_links) &lt; 3 ) {
	        	$sentence = implode (" and ", $titles_as_links);
	        } else {
	        	$last = array_pop($titles_as_links);
	        	$sentence = implode(", ", $titles_as_links);
	        	$sentence .= ", and " . $last;
	        }

	        // Echo it
	        echo '&lt;span class="discontinued"&gt;This product has been discontinued. It has been replaced by ' . $sentence . '.&lt;/span&gt;';
	    } else {
	        echo '&lt;span class="discontinued"&gt;This product has been discontinued.&lt;/span&gt;';
	    }
	} else {
		// Product is forthcoming
		// Release date here depends on ACF return value for available_from being set
		// appropriately to display nicely.
		$release_date = get_field('available_from', $id);
		if ($release_date !== "") {
			echo '&lt;span class="forthcoming"&gt;This product is forthcoming and will be available from ' . $release_date . '&lt;/span&gt;';
		} else {
			echo '&lt;span class="forthcoming"&gt;This product is forthcoming and will be available soon!&lt;/span&gt;';
		}
	}
}
</code></pre></div></div>

<hr>

<p>This code is complicated, so I’ll do my best to break it down step by step below to explain what I’m doing. <strong>If you don’t care about how it works, the above code is all you need and the tutorial is over.</strong></p>

<p>First, we want to stop showing the add to cart buttons, and replace it with a call to our own function that just displays them instead. We’ll add the add to cart buttons back later if it turns out the product is released. Effectively, the snippet of code below has no effect.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">remove_action</span><span class="p">(</span> <span class="s1">'woocommerce_single_product_summary'</span><span class="p">,</span> <span class="s1">'woocommerce_template_single_add_to_cart'</span><span class="p">,</span> <span class="mi">30</span> <span class="p">);</span>
<span class="nf">add_filter</span><span class="p">(</span> <span class="s1">'woocommerce_single_product_summary'</span><span class="p">,</span> <span class="s1">'lifecycle_single_add_to_cart'</span><span class="p">,</span> <span class="mi">30</span> <span class="p">);</span>
<span class="k">function</span> <span class="n">lifecycle_single_add_to_cart</span><span class="p">()</span> <span class="p">{</span>
	<span class="nf">woocommerce_template_single_add_to_cart</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<hr>

<p>Now instead of simply showing the add the cart buttons all the time, we only want to show them if the product is released. This piece of code essentially just removes the add to cart buttons when the product is not released, and replaces it with a simple <code class="language-plaintext highlighter-rouge">span</code> that says if the product is forthcoming or discontinued.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>remove_action( 'woocommerce_single_product_summary', 'woocommerce_template_single_add_to_cart', 30 );
add_filter( 'woocommerce_single_product_summary', 'lifecycle_single_add_to_cart', 30 );
/* Helper functions to generate the discontinued replacement products list: */
function id_to_link($product_id){
    $product = wc_get_product( $product_id );
    return '&lt;a href="'. get_permalink( $product_id ) .'"&gt;' . $product-&gt;get_title() . '&lt;/a&gt;';
}
function lifecycle_single_add_to_cart() {
	global $product;
	$id = $product-&gt;get_id();
	$status = get_field('product_status', $id);

	if ( is_released($id) ) {
		/* Product is released, so use the default add to cart buttons */
		woocommerce_template_single_add_to_cart();
	} else if ( is_discontinued($id) ) {
	    echo '&lt;span class="discontinued"&gt;This product has been discontinued.&lt;/span&gt;';
	} else {
		echo '&lt;span class="forthcoming"&gt;This product is forthcoming and will be available soon!&lt;/span&gt;';
	}
}
</code></pre></div></div>

<hr>

<p>Finally, we add the code to add information like “This product has been replaced by Product X, Product Y, and Product Z”, and “This product will be available on January 1st, 2020”.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">remove_action</span><span class="p">(</span> <span class="s1">'woocommerce_single_product_summary'</span><span class="p">,</span> <span class="s1">'woocommerce_template_single_add_to_cart'</span><span class="p">,</span> <span class="mi">30</span> <span class="p">);</span>
<span class="nf">add_filter</span><span class="p">(</span> <span class="s1">'woocommerce_single_product_summary'</span><span class="p">,</span> <span class="s1">'lifecycle_single_add_to_cart'</span><span class="p">,</span> <span class="mi">30</span> <span class="p">);</span>
<span class="cm">/* Helper functions to generate the discontinued replacement products list: */</span>
<span class="k">function</span> <span class="n">id_to_link</span><span class="p">(</span><span class="nv">$product_id</span><span class="p">){</span>
    <span class="nv">$product</span> <span class="o">=</span> <span class="nf">wc_get_product</span><span class="p">(</span> <span class="nv">$product_id</span> <span class="p">);</span>
    <span class="k">return</span> <span class="s1">'&lt;a href="'</span><span class="mf">.</span> <span class="nf">get_permalink</span><span class="p">(</span> <span class="nv">$product_id</span> <span class="p">)</span> <span class="mf">.</span><span class="s1">'"&gt;'</span> <span class="mf">.</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="nf">get_title</span><span class="p">()</span> <span class="mf">.</span> <span class="s1">'&lt;/a&gt;'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">lifecycle_single_add_to_cart</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">global</span> <span class="nv">$product</span><span class="p">;</span>
	<span class="nv">$id</span> <span class="o">=</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="nf">get_id</span><span class="p">();</span>
	<span class="nv">$status</span> <span class="o">=</span> <span class="nf">get_field</span><span class="p">(</span><span class="s1">'product_status'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span> <span class="nf">is_released</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Product is released, so use the default add to cart buttons */</span>
		<span class="nf">woocommerce_template_single_add_to_cart</span><span class="p">();</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nf">is_discontinued</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>

		<span class="c1">// Replaced with is an array containing the ids of replacement products</span>
		<span class="nv">$replaced_with</span> <span class="o">=</span> <span class="nf">get_field</span><span class="p">(</span><span class="s1">'replaced_with'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
	    <span class="k">if</span><span class="p">(</span><span class="nv">$replaced_with</span><span class="p">)</span> <span class="p">{</span>

	        <span class="c1">// Turn the array of id's of replacement products into an array of links</span>
	        <span class="nv">$titles_as_links</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$product_id</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nf">id_to_link</span><span class="p">(</span><span class="nv">$product_id</span><span class="p">);},</span> <span class="nv">$replaced_with</span><span class="p">);</span>

	        <span class="c1">// We want to join the array to follow the rules of sentences, like this:</span>
	        <span class="c1">// item 1, item 2, and item 3</span>
	        <span class="c1">// ... rather than just item 1, item 2, item 3, like regular implode would.</span>
	        <span class="k">if</span> <span class="p">(</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$titles_as_links</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">)</span> <span class="p">{</span>
	        	<span class="nv">$sentence</span> <span class="o">=</span> <span class="nb">implode</span> <span class="p">(</span><span class="s2">" and "</span><span class="p">,</span> <span class="nv">$titles_as_links</span><span class="p">);</span>
	        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	        	<span class="nv">$last</span> <span class="o">=</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$titles_as_links</span><span class="p">);</span>
	        	<span class="nv">$sentence</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">", "</span><span class="p">,</span> <span class="nv">$titles_as_links</span><span class="p">);</span>
	        	<span class="nv">$sentence</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">", and "</span> <span class="mf">.</span> <span class="nv">$last</span><span class="p">;</span>
	        <span class="p">}</span>

	        <span class="c1">// Echo it</span>
	        <span class="k">echo</span> <span class="s1">'&lt;span class="discontinued"&gt;This product has been discontinued. It has been replaced by '</span> <span class="mf">.</span> <span class="nv">$sentence</span> <span class="mf">.</span> <span class="s1">'.&lt;/span&gt;'</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	        <span class="k">echo</span> <span class="s1">'&lt;span class="discontinued"&gt;This product has been discontinued.&lt;/span&gt;'</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="c1">// Product is forthcoming</span>
		<span class="c1">// Release date here depends on ACF return value for available_from being set</span>
		<span class="c1">// appropriately to display nicely.</span>
		<span class="nv">$release_date</span> <span class="o">=</span> <span class="nf">get_field</span><span class="p">(</span><span class="s1">'available_from'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$release_date</span> <span class="o">!==</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">echo</span> <span class="s1">'&lt;span class="forthcoming"&gt;This product is forthcoming and will be available from '</span> <span class="mf">.</span> <span class="nv">$release_date</span> <span class="mf">.</span> <span class="s1">'&lt;/span&gt;'</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">echo</span> <span class="s1">'&lt;span class="forthcoming"&gt;This product is forthcoming and will be available soon!&lt;/span&gt;'</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>…and we’re back to where we were! And with this, we’re done.</p>

<h1 id="bringing-it-all-together-tldr">Bringing it all together (TL:DR)</h1>

<p>AKA, this is the “Too Long, Didn’t Read section”. I always skip to this section. <img class="emoji" title=":upside_down_face:" alt=":upside_down_face:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f643.png" height="20" width="20"></p>

<p>The full code for your <code class="language-plaintext highlighter-rouge">functions.php</code> file is <a href="https://gist.github.com/Jetroid/ff0c7936a80bb006ba009a7c2ec9e83d">here</a> (and below), and the <a href="https://www.advancedcustomfields.com/">Advanced Custom Fields</a> import data is <a href="/assets/product-lifestyle-acf.json">here</a>.</p>

<p>Full code follows:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">is_released</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$status</span> <span class="o">=</span> <span class="nf">get_field</span><span class="p">(</span><span class="s1">'product_status'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>

	<span class="c1">// We consider null to be for sale, as this indicates an old product</span>
	<span class="c1">// where we haven't made a selection yet</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$status</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$status</span> <span class="o">===</span> <span class="s2">"forsale"</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">True</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$status</span> <span class="o">===</span> <span class="s2">"forthcoming"</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* A product can also be released if it was forthcoming
		with an 'available from' date that has passed */</span>
		<span class="nv">$release_date</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nf">get_field</span><span class="p">(</span><span class="s1">'available_from'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">));</span>
		<span class="c1">// Check that a release date was set, and that the date has passed.</span>
		<span class="k">return</span> <span class="nv">$release_date</span> <span class="o">&amp;&amp;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nv">$release_date</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">False</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">is_forthcoming</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$status</span> <span class="o">=</span> <span class="nf">get_field</span><span class="p">(</span><span class="s1">'product_status'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$status</span> <span class="o">===</span> <span class="s2">"forthcoming"</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$release_date</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nf">get_field</span><span class="p">(</span><span class="s1">'available_from'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">));</span>
		<span class="c1">// Either no release date was set, or the date has not passed.</span>
		<span class="k">return</span> <span class="o">!</span><span class="nv">$release_date</span> <span class="o">||</span> <span class="nb">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nv">$release_date</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">False</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">is_discontinued</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$status</span> <span class="o">=</span> <span class="nf">get_field</span><span class="p">(</span><span class="s1">'product_status'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
	<span class="k">return</span> <span class="nv">$status</span> <span class="o">===</span> <span class="s2">"discontinued"</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Prevent purchase of products that have not been released */</span>
<span class="nf">add_filter</span><span class="p">(</span><span class="s1">'woocommerce_is_purchasable'</span><span class="p">,</span> <span class="s1">'lifecycle_woocommerce_is_purchasable'</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">function</span> <span class="n">lifecycle_woocommerce_is_purchasable</span><span class="p">(</span><span class="nv">$is_purchasable</span><span class="p">,</span> <span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nv">$is_purchasable</span> <span class="o">&amp;&amp;</span> <span class="nf">is_released</span><span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="nf">get_id</span><span class="p">());</span>
<span class="p">}</span>

<span class="nf">add_filter</span><span class="p">(</span><span class="s1">'woocommerce_variation_is_purchasable'</span><span class="p">,</span> <span class="s1">'lifecycle_woocommerce_variation_is_purchasable'</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">function</span> <span class="n">lifecycle_woocommerce_variation_is_purchasable</span><span class="p">(</span><span class="nv">$is_purchasable</span><span class="p">,</span> <span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nv">$is_purchasable</span> <span class="o">&amp;&amp;</span> <span class="nf">is_released</span><span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="nf">get_parent_id</span><span class="p">());</span>
<span class="p">}</span>

<span class="cm">/* Remove the add to cart buttons... We add it back later when needed */</span>
<span class="nf">remove_action</span><span class="p">(</span> <span class="s1">'woocommerce_single_product_summary'</span><span class="p">,</span> <span class="s1">'woocommerce_template_single_add_to_cart'</span><span class="p">,</span> <span class="mi">30</span> <span class="p">);</span>

<span class="cm">/* Replace the add to cart buttons with our custom text */</span>
<span class="nf">add_filter</span><span class="p">(</span> <span class="s1">'woocommerce_single_product_summary'</span><span class="p">,</span> <span class="s1">'lifecycle_single_add_to_cart'</span><span class="p">,</span> <span class="mi">30</span> <span class="p">);</span>
<span class="cm">/* Helper functions to generate the discontinued replacement products list: */</span>
<span class="k">function</span> <span class="n">id_to_link</span><span class="p">(</span><span class="nv">$product_id</span><span class="p">){</span>
    <span class="nv">$product</span> <span class="o">=</span> <span class="nf">wc_get_product</span><span class="p">(</span> <span class="nv">$product_id</span> <span class="p">);</span>
    <span class="k">return</span> <span class="s1">'&lt;a href="'</span><span class="mf">.</span> <span class="nf">get_permalink</span><span class="p">(</span> <span class="nv">$product_id</span> <span class="p">)</span> <span class="mf">.</span><span class="s1">'"&gt;'</span> <span class="mf">.</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="nf">get_title</span><span class="p">()</span> <span class="mf">.</span> <span class="s1">'&lt;/a&gt;'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="n">lifecycle_single_add_to_cart</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">global</span> <span class="nv">$product</span><span class="p">;</span>
	<span class="nv">$id</span> <span class="o">=</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="nf">get_id</span><span class="p">();</span>
	<span class="nv">$status</span> <span class="o">=</span> <span class="nf">get_field</span><span class="p">(</span><span class="s1">'product_status'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span> <span class="nf">is_released</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Product is released, so use the default add to cart buttons */</span>
		<span class="nf">woocommerce_template_single_add_to_cart</span><span class="p">();</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nf">is_discontinued</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>

		<span class="c1">// Replaced with is an array containing the ids of replacement products</span>
		<span class="nv">$replaced_with</span> <span class="o">=</span> <span class="nf">get_field</span><span class="p">(</span><span class="s1">'replaced_with'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
	    <span class="k">if</span><span class="p">(</span><span class="nv">$replaced_with</span><span class="p">)</span> <span class="p">{</span>

	        <span class="c1">// Turn the array of id's of replacement products into an array of links</span>
	        <span class="nv">$titles_as_links</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$product_id</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nf">id_to_link</span><span class="p">(</span><span class="nv">$product_id</span><span class="p">);},</span> <span class="nv">$replaced_with</span><span class="p">);</span>

	        <span class="c1">// We want to join the array to follow the rules of sentences, like this:</span>
	        <span class="c1">// item 1, item 2, and item 3</span>
	        <span class="c1">// ... rather than just item 1, item 2, item 3, like regular implode would.</span>
	        <span class="k">if</span> <span class="p">(</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$titles_as_links</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">)</span> <span class="p">{</span>
	        	<span class="nv">$sentence</span> <span class="o">=</span> <span class="nb">implode</span> <span class="p">(</span><span class="s2">" and "</span><span class="p">,</span> <span class="nv">$titles_as_links</span><span class="p">);</span>
	        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	        	<span class="nv">$last</span> <span class="o">=</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$titles_as_links</span><span class="p">);</span>
	        	<span class="nv">$sentence</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">", "</span><span class="p">,</span> <span class="nv">$titles_as_links</span><span class="p">);</span>
	        	<span class="nv">$sentence</span> <span class="mf">.</span><span class="o">=</span> <span class="s2">", and "</span> <span class="mf">.</span> <span class="nv">$last</span><span class="p">;</span>
	        <span class="p">}</span>

	        <span class="c1">// Echo it</span>
	        <span class="k">echo</span> <span class="s1">'&lt;span class="discontinued"&gt;This product has been discontinued. It has been replaced by '</span> <span class="mf">.</span> <span class="nv">$sentence</span> <span class="mf">.</span> <span class="s1">'.&lt;/span&gt;'</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	        <span class="k">echo</span> <span class="s1">'&lt;span class="discontinued"&gt;This product has been discontinued.&lt;/span&gt;'</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="c1">// Product is forthcoming</span>
		<span class="c1">// Release date here depends on ACF return value for available_from being set</span>
		<span class="c1">// appropriately to display nicely.</span>
		<span class="nv">$release_date</span> <span class="o">=</span> <span class="nf">get_field</span><span class="p">(</span><span class="s1">'available_from'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$release_date</span> <span class="o">!==</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">echo</span> <span class="s1">'&lt;span class="forthcoming"&gt;This product is forthcoming and will be available from '</span> <span class="mf">.</span> <span class="nv">$release_date</span> <span class="mf">.</span> <span class="s1">'&lt;/span&gt;'</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">echo</span> <span class="s1">'&lt;span class="forthcoming"&gt;This product is forthcoming and will be available soon!&lt;/span&gt;'</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>


</div>
		
		<p id="calltoaction"><em>P.S. I'm late to the party, but I recently got <a href="https://twitter.com/JetroidMakes">a twitter account</a> that you can follow <a href="https://twitter.com/intent/user?screen_name=JetroidMakes">here</a>.</em></p>
		
	</article>
	<hr class="divider">
	
	<div id="mailchimp-signup">
<h2 id="mailchimp-text">Receive an email whenever I post. <span class="nobr">No spam, no ads,</span> <a class="nobr" href="http://us17.campaign-archive.com/home/?u=5c7e4e051f07ca709dea5942a&amp;id=027962a690">just notifications</a>
</h2>
<form action="https://jetholt.us17.list-manage.com/subscribe/post?u=5c7e4e051f07ca709dea5942a&amp;id=027962a690" method="post" target="_blank">
	<input class="mailchimp-entry" type="text" name="FNAME" placeholder="Name" required>
	<input class="mailchimp-entry" type="email" name="EMAIL" placeholder="Email" required>
	<!-- real people should not fill this next one in and expect good things - do not remove this or risk form bot signups !-->
	<input type="text" name="b_5c7e4e051f07ca709dea5942a_027962a690" tabindex="-1" value="" hidden>
	<input id="mailchimp-submit" type="submit" value="Subscribe" name="subscribe" class="button">
</form>
</div>

	<hr class="divider">
	
	<footer id="navigation">
		
			<a id="prev-post" href="/bangkok-again/">‹Once More Unto Bangkok</a>
		
		
			<a id="next-post" href="/seismograf-bug/">Seismograf Bug›</a>
		
	</footer>
</div>
</div>

		<!-- Custom JS
			Seperate file - use js in YAML front matter
			Inline - use inline_js in YAML front matter !--><!-- Custom JS (as seperate file) - use custom_js in YAML front matter !-->






<script>

</script>



<script async src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.4.0/dist/lazyload.min.js"></script>
		</div>
	</body>
</html>

